<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Demo ‚Äî SQL Injection (simulada)</title>
  <style>
    :root {
      --bg: #f6f9fc;
      --card: #ffffff;
      --accent: #0369a1;
      --muted: #475569;
      --danger: #ef4444;
      --ok: #10b981
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: Inter, system-ui, Arial;
      background: var(--bg);
      color: #0f172a;
      padding: 22px
    }

    .container {
      max-width: 980px;
      margin: 0 auto
    }

    .card {
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 8px 26px rgba(2, 6, 23, 0.06)
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px
    }

    h1 {
      margin: 0;
      color: var(--accent);
      font-size: 20px
    }

    p.lead {
      margin: 6px 0 0;
      color: var(--muted)
    }

    form {
      margin-top: 14px
    }

    label {
      display: block;
      margin-top: 10px;
      color: #334155;
      font-weight: 600
    }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #e6eef6;
      margin-top: 6px;
      font: inherit
    }

    .actions {
      display: flex;
      gap: 10px;
      margin-top: 12px
    }

    button {
      padding: 10px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600
    }

    button.primary {
      background: var(--accent);
      color: white
    }

    button.ghost {
      background: transparent;
      border: 1px solid #e6eef6
    }

    .result {
      margin-top: 14px;
      padding: 12px;
      border-radius: 8px;
      background: #fbfdff;
      border: 1px solid #eef6fb
    }

    pre {
      background: #f3f4f6;
      padding: 10px;
      border-radius: 6px;
      overflow: auto
    }

    .badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(3, 105, 161, 0.08);
      color: var(--accent);
      font-weight: 600
    }

    .danger {
      background: #fff1f2;
      border-left: 4px solid var(--danger);
      padding: 10px;
      border-radius: 6px;
      color: #7f1d1d
    }

    .ok {
      background: #ecfdf5;
      border-left: 4px solid var(--ok);
      padding: 10px;
      border-radius: 6px;
      color: #065f46
    }

    details {
      margin-top: 12px
    }

    summary {
      font-weight: 600;
      color: #0f172a
    }

    ul {
      margin: 8px 0 0 18px;
      color: var(--muted)
    }

    footer {
      margin-top: 16px;
      color: var(--muted);
      font-size: 13px
    }

    @media(max-width:720px) {
      .actions {
        flex-direction: column
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card" role="article" aria-labelledby="title">
      <header>
        <div>
          <h1 id="title">Simulaci√≥n: Inyecci√≥n SQL</h1>
          <div class="lead">Objetivo: comprender la mec√°nica de una consulta insegura y practicar mitigaciones b√°sicas.
          </div>
        </div>
        <div class="badge">A03 ‚Äî OWASP (simulado)</div>
      </header>

      <form id="form">
        <label for="user">Usuario</label>
        <input id="user" type="text" value="valery" autocomplete="off" aria-describedby="hint-user">
        <small id="hint-user" style="color:var(--muted)">Ejemplo: <code>valery</code></small>

        <label for="pass">Contrase√±a</label>
        <input id="pass" type="password" value="1234" autocomplete="off">

        <div class="actions">
          <button type="button" id="toggleVuln" class="ghost" aria-pressed="false">Mostrar modo vulnerable
            (simulado)</button>
          <button type="button" id="simulate" class="primary">Simular inicio de sesi√≥n</button>
          <button type="button" id="limpiar" class="ghost">Limpiar</button>
        </div>
      </form>

      <div id="output" class="result" aria-live="polite"></div>

      <details>
        <summary>Explicaci√≥n detallada y mitigaciones</summary>
        <ul>
          <li>La consulta vulnerable se construye concatenando entradas:
            <code>SELECT * FROM usuarios WHERE usuario = '...' AND clave = '...'</code>.</li>
          <li>Un atacante puede introducir operadores o comentarios como <code>' OR '1'='1</code> para alterar la
            l√≥gica.</li>
          <li><strong>Mitigaciones:</strong> usar consultas parametrizadas (Prepared Statements), validaci√≥n de entrada
            en servidor y principios de menor privilegio en la base de datos.</li>
        </ul>
      </details>

      <footer>
        <small>Nota: esta p√°gina simula los efectos localmente y no ejecuta consultas en bases reales. Est√° dise√±ada
          para uso educativo.</small>
      </footer>
    </div>
  </div>

  <script>
    (function () {
      const btnV = document.getElementById('toggleVuln');
      const btnSim = document.getElementById('simulate');
      const btnLim = document.getElementById('limpiar');
      const out = document.getElementById('output');
      let vuln = false;

      const usuarios = [{ u: 'valery', p: '1234' }, { u: 'admin', p: 'admin123' }];

      function detectarInyeccion(s) {
        if (!s) return false;
        const patrones = ["'", "--", ";", "/*", "*/", " OR ", " AND ", "1=1"];
        const may = s.toUpperCase();
        return patrones.some(p => may.includes(p.trim().toUpperCase()));
      }

      btnV.addEventListener('click', () => {
        vuln = !vuln;
        btnV.setAttribute('aria-pressed', String(vuln));
        btnV.textContent = vuln ? 'Modo vulnerable activado (simulado)' : 'Mostrar modo vulnerable (simulado)';
        out.innerHTML = vuln ? '<div class="danger">‚ö†Ô∏è Ha activado el modo vulnerable. Observe c√≥mo se construye la consulta concatenada.</div>' : '<div class="ok">üîí Modo seguro activo: las entradas se tratan como par√°metros (simulado).</div>';
      });

      btnLim.addEventListener('click', () => {
        document.getElementById('user').value = 'valery';
        document.getElementById('pass').value = '1234';
        out.innerHTML = '';
      });

      btnSim.addEventListener('click', () => {
        const u = document.getElementById('user').value.trim();
        const p = document.getElementById('pass').value;
        // Construcci√≥n simulada de consulta (NO ejecutar en BD real)
        const consulta = `SELECT * FROM usuarios WHERE usuario = '${u}' AND clave = '${p}'`;
        let html = `<strong>Consulta simulada:</strong><pre>${consulta}</pre>`;

        // Si modo vulnerable y patrones detectados -> marcar alerta
        if (vuln && (detectarInyeccion(u) || detectarInyeccion(p))) {
          html += `<div class="danger">‚ö†Ô∏è Posible inyecci√≥n detectada (simulada). La entrada modifica la l√≥gica de la consulta.</div>`;
        } else {
          // Validaci√≥n simple contra lista local (simulada)
          const ok = usuarios.some(x => x.u === u && x.p === p);
          if (ok) {
            html += `<div class="ok">‚úÖ Inicio de sesi√≥n simulado exitoso.</div>`;
          } else {
            html += `<div class="danger">‚ùå Usuario o contrase√±a incorrectos (simulado).</div>`;
          }
        }

        out.innerHTML = html;
      });

    })();
  </script>
</body>

</html>